# Question: How can we identify differentially expressed genes (DEGs) from RNA-Seq data using Python?

## Solution

### Step 1: Install Required Libraries

Make sure you have the necessary libraries installed. You can do this using pip:

```bash
pip install pandas numpy scipy statsmodels matplotlib seaborn
```

### Step 2: Load RNA-Seq Data

Assume you have a count matrix stored in a CSV file called `counts.csv` where rows represent genes and columns represent samples.

```python
import pandas as pd

# Load the count data
data = pd.read_csv('counts.csv', index_col=0)
print(data.head())
```

### Step 3: Prepare the Data

Prepare your metadata file (for example, `metadata.csv`) which describes the conditions of each sample.

```python
# Load the metadata
metadata = pd.read_csv('metadata.csv')
print(metadata.head())
```

### Step 4: Filter Lowly Expressed Genes

Filter out genes with low counts across all samples.

```python
# Filter out lowly expressed genes
threshold = 10
filtered_data = data[data.sum(axis=1) > threshold]
print(filtered_data.head())
```

### Step 5: Normalize the Data

Normalize the data using a method such as the TMM (Trimmed Mean of M-values) normalization.

```python
import numpy as np
import statsmodels.api as sm

# Normalize counts using TMM
def normalize_counts(counts):
    counts = counts + 1  # add a constant to avoid log(0)
    log_counts = np.log(counts)
    mean_log_counts = np.mean(log_counts, axis=1)
    normalization_factors = np.exp(mean_log_counts)
    normalized_counts = counts / normalization_factors[:, None]
    return normalized_counts

normalized_data = normalize_counts(filtered_data)
```

### Step 6: Conduct Differential Expression Analysis

Use a statistical test (e.g., t-test) to identify DEGs between two conditions.

```python
from scipy.stats import ttest_ind

condition_1 = metadata[metadata['condition'] == 'A'].index
condition_2 = metadata[metadata['condition'] == 'B'].index

p_values = []
for gene in normalized_data.index:
    group1 = normalized_data.loc[gene, condition_1]
    group2 = normalized_data.loc[gene, condition_2]
    t_stat, p_val = ttest_ind(group1, group2)
    p_values.append(p_val)

# Add p-values to the dataframe
filtered_data['p_value'] = p_values
```

### Step 7: Adjust p-values for Multiple Testing

Use the Benjamini-Hochberg method to adjust the p-values.

```python
from statsmodels.stats.multitest import multipletests

filtered_data['adj_p_value'] = multipletests(filtered_data['p_value'], method='fdr_bh')[1]
```

### Step 8: Identify Significant DEGs

Set a threshold for statistical significance (e.g., adj_p_value < 0.05).

```python
significant_degs = filtered_data[filtered_data['adj_p_value'] < 0.05]
print(significant_degs)
```

### Step 9: Visualize the Results

Create a volcano plot to visualize the DEGs.

```python
import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize=(10, 6))
sns.scatterplot(x=np.log2(filtered_data['fold_change']), y=-np.log10(filtered_data['adj_p_value']),
                hue=(filtered_data['adj_p_value'] < 0.05), palette=['red', 'grey'], alpha=0.6)
plt.axhline(y=-np.log10(0.05), color='r', linestyle='--')
plt.axvline(x=0, color='grey', linestyle='--')
plt.title('Volcano Plot of Differential Gene Expression')
plt.xlabel('Log2 Fold Change')
plt.ylabel('-Log10 Adjusted P-value')
plt.show()
```

### Summary

This tutorial demonstrated how to identify differentially expressed genes (DEGs) from RNA-Seq data using Python, covering data loading, normalization, statistical testing, multiple testing correction, and visualization.